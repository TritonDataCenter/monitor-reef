# Bugview CLI

A command-line interface for interacting with the Bugview public issue viewer service.

## Overview

This CLI demonstrates the complete trait-based API workflow in this monorepo:
1. **API trait** defined in `apis/bugview-api`
2. **Service** implemented in `services/bugview-service`
3. **OpenAPI spec** generated by `openapi-manager`
4. **Client library** auto-generated from spec in `clients/internal/bugview-client`
5. **CLI application** built using the generated client (this crate)

## Installation

Build from the monorepo root:

```bash
cargo build -p bugview-cli --release
```

The binary will be available at `target/release/bugview`.

## Usage

Two simple commands:
- **`bugview list`** - List all public issues with pagination
- **`bugview get <KEY>`** - View a complete issue (terminal-friendly or raw JSON with `--raw`)

### List Public Issues

List all public issues with pagination support:

```bash
bugview list

# With sorting
bugview list --sort created
bugview list --sort updated
bugview list --sort key

# Pagination
bugview list --next-page-token "TOKEN_FROM_PREVIOUS_RESPONSE"
```

### Get Issue Details

View a complete issue in terminal-friendly format (like viewing it on the web):

```bash
bugview get PROJECT-123
```

Output:
```
══════════════════════════════════════════════════════════════════
OS-8490 - Update OpenSSH to 9.5p1
══════════════════════════════════════════════════════════════════

Status:     Resolved
Type:       Task
Priority:   Normal
Assignee:   Dan McDonald
Resolution: Fixed
Created:    Oct 4, 2023
Updated:    Oct 18, 2023

View in browser: https://smartos.org/bugview/issue/OS-8490

──────────────────────────────────────────────────────────────────
Description:
──────────────────────────────────────────────────────────────────

Today OpenSSH announced 9.5. It includes a potentially-breaking
change where ssh-keygen now (as of 9.5) generates ed25519 keys by
default. This may motivate [TRITON-2378], and other changes...
```

For raw JSON output (useful for scripting):

```bash
bugview get PROJECT-123 --raw
```

## Configuration

### Base URL

By default, the CLI connects to `http://localhost:8080`. Override with:

```bash
bugview --base-url https://bugview.example.com list
```

## Examples

```bash
# List the first page of issues
bugview list

# View a complete issue (web-like view)
bugview get OS-8490

# Get raw JSON for scripting
bugview get OS-8490 --raw

# Connect to production service
bugview --base-url https://bugs.company.com list
bugview --base-url https://bugs.company.com get PROJ-42
```

## Architecture

This CLI is a thin wrapper around the auto-generated `bugview-client` library:

```
bugview-cli (this crate)
    └─> bugview-client (Progenitor-generated)
            └─> bugview-api (OpenAPI spec)
                    └─> bugview-service (Dropshot implementation)
```

### Why This Design?

- **Type safety**: The client is generated from the OpenAPI spec, ensuring correctness
- **Maintainability**: API changes automatically flow to the CLI through regeneration
- **Reusability**: The client library can be used by other Rust applications
- **Consistency**: Same API contract across service, docs, and clients

## Development

### Running Locally

1. Start the Bugview service:
   ```bash
   cargo run -p bugview-service
   ```

2. Use the CLI:
   ```bash
   cargo run -p bugview-cli -- list
   ```

### Testing Against Real Service

If you have a running Bugview service with real data:

```bash
cargo run -p bugview-cli -- --base-url http://localhost:8080 list
```

## Limitations

- Read-only: This CLI only supports viewing public issues (Bugview is a read-only API)
- HTML endpoints: The CLI uses JSON endpoints; HTML views are available via browser
- Authentication: Not needed for public issues; add if implementing private issue support

## Related Crates

- **bugview-api**: API trait definition
- **bugview-service**: Service implementation
- **bugview-client**: Generated client library (used by this CLI)

## Contributing

When the Bugview API changes:

1. Update the API trait in `apis/bugview-api`
2. Regenerate specs: `cargo run -p openapi-manager -- generate`
3. Rebuild client: `cargo build -p bugview-client`
4. Update CLI if new endpoints are added
5. Test the changes: `cargo run -p bugview-cli -- --help`
